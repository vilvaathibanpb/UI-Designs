{"version":3,"sources":["../index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Module dependencies.\n */\nimport requestHandler from 'wpcom-xhr-request';\nimport debugModule from 'debug';\n\n/**\n * Local module dependencies.\n */\nimport Batch from './lib/batch';\nimport Domain from './lib/domain';\nimport Domains from './lib/domains';\nimport Marketing from './lib/marketing';\nimport Me from './lib/me';\nimport Pinghub from './lib/util/pinghub';\nimport Plans from './lib/plans';\nimport Request from './lib/util/request';\nimport Site from './lib/site';\nimport Users from './lib/users';\nimport sendRequest from './lib/util/send-request';\n\n/**\n * Local module constants\n */\nconst debug = debugModule( 'wpcom' );\nconst DEFAULT_ASYNC_TIMEOUT = 30000;\n\n/**\n * XMLHttpRequest (and CORS) API access method.\n *\n * API authentication is done via an (optional) access `token`,\n * which needs to be retrieved via OAuth.\n *\n * Request Handler is optional and XHR is defined as default.\n *\n * @param {String} [token] - OAuth API access token\n * @param {Function} [reqHandler] - function Request Handler\n * @return {WPCOM} wpcom instance\n */\nexport default function WPCOM( token, reqHandler ) {\n\tif ( ! ( this instanceof WPCOM ) ) {\n\t\treturn new WPCOM( token, reqHandler );\n\t}\n\n\t// `token` is optional\n\tif ( 'function' === typeof token ) {\n\t\treqHandler = token;\n\t\ttoken = null;\n\t}\n\n\tif ( token ) {\n\t\tdebug( 'Token defined: %sâ€¦', token.substring( 0, 6 ) );\n\t\tthis.token = token;\n\t}\n\n\t// Set default request handler\n\tif ( ! reqHandler ) {\n\t\tdebug( 'No request handler. Adding default XHR request handler' );\n\n\t\tthis.request = function( params, fn ) {\n\t\t\tparams = params || {};\n\n\t\t\t// token is optional\n\t\t\tif ( token ) {\n\t\t\t\tparams.authToken = token;\n\t\t\t}\n\n\t\t\treturn requestHandler( params, fn );\n\t\t};\n\t} else {\n\t\tthis.request = reqHandler;\n\t}\n\n\t// Add Req instance\n\tthis.req = new Request( this );\n\n\t// Add Pinghub instance\n\tthis.pinghub = new Pinghub( this );\n\n\t// Default api version;\n\tthis.apiVersion = '1.1';\n}\n\n/**\n * Return `Marketing` object instance\n *\n * @return {Marketing} Marketing instance\n */\nWPCOM.prototype.marketing = function() {\n\treturn new Marketing( this );\n};\n\n/**\n * Return `Me` object instance\n *\n * @return {Me} Me instance\n */\nWPCOM.prototype.me = function() {\n\treturn new Me( this );\n};\n\n/**\n * Return `Domains` object instance\n *\n * @return {Domains} Domains instance\n */\nWPCOM.prototype.domains = function() {\n\treturn new Domains( this );\n};\n\n/**\n * Return `Domain` object instance\n *\n * @param {String} domainId - domain identifier\n * @return {Domain} Domain instance\n */\nWPCOM.prototype.domain = function( domainId ) {\n\treturn new Domain( domainId, this );\n};\n\n/**\n * Return `Site` object instance\n *\n * @param {String} id - site identifier\n * @return {Site} Site instance\n */\nWPCOM.prototype.site = function( id ) {\n\treturn new Site( id, this );\n};\n\n/**\n * Return `Users` object instance\n *\n * @return {Users} Users instance\n */\nWPCOM.prototype.users = function() {\n\treturn new Users( this );\n};\n\n/**\n * Return `Plans` object instance\n *\n * @return {Plans} Plans instance\n */\nWPCOM.prototype.plans = function() {\n\treturn new Plans( this );\n};\n\n /**\n * Return `Batch` object instance\n *\n * @return {Batch} Batch instance\n */\nWPCOM.prototype.batch = function() {\n\treturn new Batch( this );\n};\n\n/**\n * List Freshly Pressed Posts\n *\n * @param {Object} [query] - query object\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nWPCOM.prototype.freshlyPressed = function( query, fn ) {\n\treturn this.req.get( '/freshly-pressed', query, fn );\n};\n\n/**\n * Expose send-request\n * @TODO: use `this.req` instead of this method\n */\nWPCOM.prototype.sendRequest = function( params, query, body, fn ) {\n\tvar msg = 'WARN! Don use `sendRequest() anymore. Use `this.req` method.';\n\n\tif ( console && console.warn ) {\n\t\tconsole.warn( msg );\n\t} else {\n\t\tconsole.log( msg );\n\t}\n\n\treturn sendRequest.call( this, params, query, body, fn );\n};\n\n/**\n * Re-export all the class types.\n */\nWPCOM.Batch = Batch;\nWPCOM.Domain = Domain;\nWPCOM.Domains = Domains;\nWPCOM.Marketing = Marketing;\nWPCOM.Me = Me;\nWPCOM.Pinghub = Pinghub;\nWPCOM.Plans = Plans;\nWPCOM.Request = Request;\nWPCOM.Site = Site;\nWPCOM.Users = Users;\n\nif ( ! Promise.prototype.timeout ) {\n\t/**\n\t* Returns a new promise with a deadline\n\t*\n\t* After the timeout interval, the promise will\n\t* reject. If the actual promise settles before\n\t* the deadline, the timer is cancelled.\n\t*\n\t* @param {number} delay how many ms to wait\n\t* @return {Promise} promise\n\t*/\n\tPromise.prototype.timeout = function( delay = DEFAULT_ASYNC_TIMEOUT ) {\n\t\tlet cancelTimeout, timer, timeout;\n\n\t\ttimeout = new Promise( ( resolve, reject ) => {\n\t\t\ttimer = setTimeout( () => {\n\t\t\t\treject( new Error( 'Action timed out while waiting for response.' ) );\n\t\t\t}, delay );\n\t\t} );\n\n\t\tcancelTimeout = () => {\n\t\t\tclearTimeout( timer );\n\t\t\treturn this;\n\t\t};\n\n\t\treturn Promise.race( [\n\t\t\tthis.then( cancelTimeout ).catch( cancelTimeout ),\n\t\t\ttimeout\n\t\t] );\n\t};\n}\n"]}