{"version":3,"sources":["../index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["\n/**\n * Module dependencies.\n */\nimport WPError from 'wp-error';\nimport superagent from 'superagent';\nimport debugFactory from 'debug';\n\n/**\n * Module variables\n */\nconst debug = debugFactory( 'wpcom-xhr-request' );\n\n/**\n * Defauts\n */\nconst defaults = {\n\tapiVersion: '1',\n\tapiNamespace: 'wp/v2',\n\tauthToken: null,\n\tbody: null,\n\tformData: null,\n\theaders: null,\n\tmethod: 'get',\n\tquery: null,\n\tprocessResponseInEnvelopeMode: true,\n\tproxyOrigin: 'https://public-api.wordpress.com',\n\turl: ''\n};\n\n/**\n * Send the request\n *\n * @param  {Superagent} req - request instance\n * @param  {Object} settings - request settings\n * @param  {Function} fn - callback function\n * @return {Superagent} request instance\n */\nconst sendResponse = ( req, settings, fn ) => {\n\tconst {\n\t\tisEnvelopeMode,\n\t\tisRestAPI,\n\t\tprocessResponseInEnvelopeMode\n\t} = settings;\n\n\treq.end( ( error, response ) => {\n\t\tif ( error && ! response ) {\n\t\t\treturn fn( error );\n\t\t}\n\n\t\tlet { body, headers, statusCode } = response;\n\n\t\tconst { ok } = response;\n\t\tconst { path, method } = response.req;\n\t\theaders.status = statusCode;\n\n\t\tif ( ok ) {\n\t\t\tif ( isEnvelopeMode && processResponseInEnvelopeMode ) {\n\t\t\t\t// override `error`, body` and `headers`\n\t\t\t\tif ( isRestAPI ) {\n\t\t\t\t\theaders = body.headers;\n\t\t\t\t\tstatusCode = body.code;\n\t\t\t\t\tbody = body.body;\n\t\t\t\t} else {\n\t\t\t\t\theaders = body.headers;\n\t\t\t\t\tstatusCode = body.status;\n\t\t\t\t\tbody = body.body;\n\t\t\t\t}\n\n\t\t\t\theaders.status = statusCode;\n\n\t\t\t\tif ( null !== statusCode && 2 !== Math.floor( statusCode / 100 ) ) {\n\t\t\t\t\tdebug( 'Error detected!' );\n\t\t\t\t\tconst wpe = WPError( { path, method }, statusCode, body );\n\t\t\t\t\treturn fn( wpe, null, headers );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn fn( null, body, headers );\n\t\t}\n\n\t\tconst wpe = WPError( { path, method }, statusCode, body );\n\t\treturn fn( wpe, null, headers );\n\t} );\n\n\treturn req;\n};\n\n/**\n * Performs an XMLHttpRequest against the WordPress.com REST API.\n *\n * @param {Object|String} options - `request path` or `request parameters`\n * @param {Function} fn - callback function\n * @return { XHR } xhr instance\n * @api public\n */\nexport default function request( options, fn ) {\n\tif ( 'string' === typeof options ) {\n\t\toptions = { path: options };\n\t}\n\n\tconst settings = Object.assign( {}, defaults, options );\n\n\t// is REST-API api?\n\tsettings.isRestAPI = options.apiNamespace === undefined;\n\n\t// normalize request-method name\n\tsettings.method = settings.method.toLowerCase();\n\n\tconst {\n\t\tapiNamespace,\n\t\tapiVersion,\n\t\tauthToken,\n\t\tbody,\n\t\tformData,\n\t\theaders,\n\t\tisRestAPI,\n\t\tmethod,\n\t\tquery,\n\t\tproxyOrigin\n\t} = settings;\n\n\t// request base path\n\tlet basePath;\n\n\tif ( isRestAPI ) {\n\t\tbasePath = `/rest/v${ apiVersion }`;\n\t} else if ( apiNamespace && /\\//.test( apiNamespace ) ) {\n\t\tbasePath = '/' + apiNamespace;\t// wpcom/v2\n\t} else {\n\t\tbasePath = '/wp-json'; // /wp-json/sites/%s/wpcom/v2 (deprecated)\n\t}\n\n\t// Envelope mode FALSE as default\n\tsettings.isEnvelopeMode = false;\n\n\tsettings.url = proxyOrigin + basePath + settings.path;\n\tdebug( 'API URL: %o', settings.url );\n\n\t// create HTTP Request instance\n\tconst req = superagent[ method ]( settings.url );\n\n\t// querystring\n\tif ( query ) {\n\t\treq.query( query );\n\t\tdebug( 'API send URL querystring: %o', query );\n\n\t\tsettings.isEnvelopeMode = isRestAPI ? query.http_envelope : query._envelope;\n\t\tdebug( 'envelope mode: %o', settings.isEnvelopeMode );\n\t}\n\n\t// body\n\tif ( body ) {\n\t\treq.send( body );\n\t\tdebug( 'API send POST body: %o', body );\n\t}\n\n\t// POST FormData (for `multipart/form-data`, usually a file upload)\n\tif ( formData ) {\n\t\tfor ( let i = 0; i < formData.length; i++ ) {\n\t\t\tconst data = formData[ i ];\n\t\t\tconst key = data[ 0 ];\n\t\t\tconst value = data[ 1 ];\n\t\t\tdebug( 'adding FormData field %o: %o', key, value );\n\t\t\treq.field( key, value );\n\t\t}\n\t}\n\n\t// headers\n\tif ( headers ) {\n\t\treq.set( headers );\n\t\tdebug( 'adding HTTP headers: %o', headers );\n\t}\n\n\tif ( authToken ) {\n\t\treq.set( 'Authorization', `Bearer ${ authToken }` );\n\t}\n\n\tif ( ! req.get( 'Accept' ) ) {\n\t\t// set a default \"Accept\" header preferring a JSON response\n\t\treq.set( 'Accept', '*/json,*/*' );\n\t}\n\n\tsendResponse( req, settings, fn );\n\n\treturn req.xhr;\n}\n"]}